AWSTemplateFormatVersion: "2010-09-09"
Resources:
  restApi:
    Type: AWS::ApiGateway::RestApi
    Properties:
      Body:
        swagger: "2.0"
        info:
          description: "myapi2"
          version: "2020-04-03T08:43:24Z"
          title: "myapi2"
        host: "ptiildfb2e.execute-api.ap-south-1.amazonaws.com"
        basePath: "/v1"
        schemes:
        - "https"
        paths:
          /apiupload:
            post:
              consumes:
              - "application/pdf"
              produces:
              - "application/json"
              responses:
                "200":
                  description: "200 response"
                  schema:
                    $ref: "#/definitions/Empty"
              x-amazon-apigateway-integration:
                uri: "arn:aws:apigateway:ap-south-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-south-1:521124255972:function:lambdaforApi/invocations"
                responses:
                  default:
                    statusCode: "200"
                requestTemplates:
                  application/pdf: "{\n    \"key\": \"$input.params('Key')\", \"content\"\
                    : \"$input.body\"\n}"
                passthroughBehavior: "when_no_templates"
                httpMethod: "POST"
                contentHandling: "CONVERT_TO_TEXT"
                type: "aws"
        definitions:
          Empty:
            type: "object"
            title: "Empty Schema"
        x-amazon-apigateway-binary-media-types:
        - "application/pdf"
      Name: myApiGate
      Parameters:
        endpointConfigurationTypes: REGIONAL    
  lambdaApiGatewayInvoke:
    Type: "AWS::Lambda::Permission"
    Properties:
      Action: "lambda:InvokeFunction"
      FunctionName: "arn:aws:lambda:ap-south-1:521124255972:function:lambdaforApi"
      Principal: "apigateway.amazonaws.com"
      SourceArn: !Sub "arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${restApi}/*/POST/"
  LambdaSNS:
    Type: "AWS::Lambda::Permission"
    Properties:
      Action: "lambda:InvokeFunction"
      FunctionName: "arn:aws:lambda:ap-south-1:521124255972:function:lambdaforApi"
      Principal: "sns.amazonaws.com"
      SourceArn: "arn:aws:sns:ap-south-1:521124255972:s3_bucket"
